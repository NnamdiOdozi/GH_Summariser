# GitHub Repository Summariser

A FastAPI-based service that ingests GitHub repositories and optionally generates AI-powered summaries using the Doubleword API.

## Features

- **Repository Ingestion**: Clone any GitHub repo and extract its contents as a formatted digest
- **LLM Summarization**: Generate concise summaries using Doubleword's LLM API
- **REST API**: Easy integration with web or mobile frontends
- **Configurable**: Specify branch, word count, file size limits, and more

## Installation

```bash
# Install dependencies
uv sync

# Install gitingest CLI (required on server)
pip install gitingest
```

## Configuration

Create a `.env.claude` file with:

```env
GITHUB_PERSONAL_ACCESS_TOKEN=your_github_token
DOUBLEWORD_AUTH_TOKEN=your_doubleword_token
DOUBLEWORD_BASE_URL=https://api.doubleword.ai
DOUBLEWORD_MODEL=your_model
```

## Running the API

```bash
uv run python -m api.main
```

The API runs on `http://127.0.0.1:8001` (Swagger UI at `/docs`).

## API Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/api/v1/gitdigest` | Ingest a repo and optionally summarize |
| GET | `/api/v1/gitdigest/{filename}` | Download a digest file |
| GET | `/api/v1/health` | Health check |

## Branch Selection

You can specify a branch in two ways:

1. **Embed it in the URL** — e.g., `https://github.com/owner/repo/tree/dev` or `https://github.com/owner/repo/tree/feature/my-branch` (branch names with slashes are supported)
2. **Use the branch parameter** — set `branch` in the API request body or `-b` on the CLI. This overrides any branch in the URL.

If no branch is specified (either way), the repo's default branch is used.

**Note:** Branch names are case-sensitive (e.g., `Tuong` and `tuong` are different branches).

## Default File Exclusions

To keep digests focused on source code and reduce LLM token usage, the following file types are excluded by default:

| Category | Patterns |
|----------|----------|
| **Binary/media** | `*.pdf`, `*.jpg`, `*.jpeg`, `*.png`, `*.gif`, `*.bmp`, `*.svg`, `*.ico`, `*.webp`, `*.avif`, `*.jfif`, `*.tiff`, `*.tif`, `*.heic`, `*.psd`, `*.mp3`, `*.mp4`, `*.wav` |
| **Archives** | `*.zip`, `*.tar`, `*.gz`, `*.rar`, `*.7z` |
| **Executables/libs** | `*.exe`, `*.dll`, `*.so`, `*.bin` |
| **Data files** | `*.csv`, `*.dat`, `*.db`, `*.sqlite`, `*.xls`, `*.xlsx`, `*.parquet` |
| **Documents (binary)** | `*.docx`, `*.doc`, `*.pptx`, `*.ppt`, `*.odt`, `*.odp` |
| **ML model weights** | `*.pickle`, `*.pkl`, `*.h5`, `*.hdf5`, `*.npy`, `*.npz`, `*.pth`, `*.pt`, `*.onnx`, `*.tflite`, `*.weights` |
| **Lockfiles** | `*.lock` (uv.lock, package-lock.json, etc.) |
| **Data directories** | `data/*` |

**Why?** Binary files, model weights, and data directories can add thousands of lines to a digest without providing useful information for code summarization. Lockfiles list pinned dependency versions that add bulk without insight. Excluding these by default typically reduces digest size by 50-80%.

You can override the defaults via the API (`exclude_patterns` field) or CLI (`-e` flag):

```bash
# CLI: exclude only specific patterns (overrides defaults)
gitdigest -u https://github.com/owner/repo -e "*.csv" -e "*.log"
```

## Example Request

```json
{
  "url": "https://github.com/NnamdiOdozi/mlx-digit-app",
  "max_size": 10485760,
  "word_count": 500,
  "call_llm_api": true
}
```

**Optional fields:**
- `token` — GitHub PAT, only needed for private repos
- `branch` — Override branch (case-sensitive). Omit to auto-detect from URL or use repo default
- `exclude_patterns` — Custom glob patterns. When omitted or `null`, the built-in defaults above are used

## Example CURL request

```bash
curl -X 'POST' \
  'http://localhost:8001/api/v1/gitdigest' \
  -H 'accept: application/json' \
  -H 'Content-Type: application/json' \
  -d '{
  "url": "https://github.com/NnamdiOdozi/mlx-digit-app",
  "word_count": 500,
  "call_llm_api": true
}'
```

With branch and token (private repo, specific branch):

```bash
curl -X 'POST' \
  'http://localhost:8001/api/v1/gitdigest' \
  -H 'accept: application/json' \
  -H 'Content-Type: application/json' \
  -d '{
  "url": "https://github.com/owner/repo",
  "token": "ghp_your_token_here",
  "branch": "dev",
  "call_llm_api": true
}'
```

## Output

The response depends on whether LLM summarization is enabled:

- **`call_llm_api: true`** (default) — Returns a clean, structured summary generated by the Doubleword LLM API. The raw digest is still saved to disk but only the summary is returned in the response.
- **`call_llm_api: false`** — Returns the full raw repository digest content directly, so you can inspect exactly what gitingest extracted or pipe it into your own processing.

All output files are saved to the `git_summaries/` directory to keep the project root clean:
- `git_summaries/owner-repo.txt` — Raw repository digest
- `git_summaries/owner-repo_llm.json` — JSON with digest + LLM summary (only when LLM is called)

This directory is gitignored since these are generated outputs.
